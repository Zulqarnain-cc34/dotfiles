# Yazi Keymap Configuration - Complete & Organized
# Full working configuration with all custom keybindings
# Place this file at ~/.config/yazi/keymap.toml

[mgr]

keymap = [
  # ============ NAVIGATION ============
  { on = "j", run = "arrow 1 --no-wrap", desc = "Move down (no wrap)" },
  { on = "k", run = "arrow -1 --no-wrap", desc = "Move up (no wrap)" },
  { on = "l", run = "plugin smart-enter", desc = "Open file or enter directory" },
  { on = "h", run = "leave", desc = "Go back to parent directory" },
  { on = "<Up>", run = "arrow -1", desc = "Move cursor up" },
  { on = "<Down>", run = "arrow 1", desc = "Move cursor down" },

  # ============ PAGINATION ============
  { on = "<C-u>", run = "arrow -50%", desc = "Move cursor up half page" },
  { on = "<C-d>", run = "arrow 50%", desc = "Move cursor down half page" },
  { on = "<C-b>", run = "arrow -100%", desc = "Move cursor up one page" },
  { on = "<C-f>", run = "arrow 100%", desc = "Move cursor down one page" },
  { on = "<S-PageUp>", run = "arrow -50%", desc = "Move cursor up half page" },
  { on = "<S-PageDown>", run = "arrow 50%", desc = "Move cursor down half page" },
  { on = "<PageUp>", run = "arrow -100%", desc = "Move cursor up one page" },
  { on = "<PageDown>", run = "arrow 100%", desc = "Move cursor down one page" },

  # ============ BASIC CONTROLS ============
  { on = "q", run = "quit", desc = "Quit the process" },
  { on = "Q", run = "quit --no-cwd-file", desc = "Quit without cwd-file" },
  { on = "<C-c>", run = "close", desc = "Close current tab or quit" },
  { on = "<C-z>", run = "suspend", desc = "Suspend the process" },
  { on = ".", run = "hidden toggle", desc = "Toggle hidden files visibility" },

  # ============ SELECTION OPERATIONS ============
  { on = "<Space>", run = ["toggle", "arrow 1"], desc = "Toggle selection and move down" },
  { on = "u", run = ["unyank", "escape --select"], desc = "Unyank and clear all selections" },

  # ============ BUILT-IN COPY/PASTE ============
  { on = ["y", "y"], run = "yank", desc = "Yank (copy) selected files" },
  { on = ["d", "d"], run = "yank --cut", desc = "Yank (cut) selected files" },
  { on = "p", run = ["paste", "unyank"], desc = "Paste and deselect" },
  { on = "P", run = ["paste --force", "unyank"], desc = "Paste (overwrite) and deselect" },

  # ============ BUILT-IN COPY PATH ============
  { on = ["y", "p"], run = "copy path", desc = "Copy file path" },
  { on = ["y", "d"], run = "copy dirname", desc = "Copy directory path" },
  { on = ["y", "n"], run = "copy filename", desc = "Copy filename" },
  { on = ["y", "."], run = "copy name_without_ext", desc = "Copy filename without extension" },


  # ============ SEARCH / FIND ============
  { on = "/", run = "find", desc = "Find file (forward)" },
  { on = "?", run = "find --previous", desc = "Find file (backward)" },
  { on = "n", run = "find_next", desc = "Find next match" },
  { on = "N", run = "find_prev", desc = "Find previous match" },

  # ============ BUILT-IN DELETE ============
  { on = ["d", "t"], run = "remove", desc = "Trash selected files" },
  { on = ["d", "D"], run = "remove --permanently", desc = "Delete permanently" },
  { on = "<Delete>", run = "remove", desc = "Trash selected files" },

  # ============ BUILT-IN CREATE ============
  { on = ["m", "d"], run = "create --dir", desc = "Create directory" },
  { on = ["m", "f"], run = "create", desc = "Create file" },

  # ============ BUILT-IN RENAME ============
  { on = ["r", "a"], run = "rename --cursor=start", desc = "Rename (cursor at start)" },
  { on = ["r", "c"], run = "rename --cursor=before_ext", desc = "Rename (cursor before extension)" },
  { on = ["r", "e"], run = "rename --empty=ext --cursor=end", desc = "Rename extension only" },

  # ============ BUILT-IN SORT ============ 
  { on = ["s", "a"], run = "sort atime --reverse", desc = "Sort by access time (newest first)" },
  { on = ["s", "c"], run = "sort ctime --reverse", desc = "Sort by change time (newest first)" },
  { on = ["s", "e"], run = "sort ext --reverse", desc = "Sort by extension (reverse)" },
  { on = ["s", "n"], run = "sort natural --reverse", desc = "Sort by name naturally (reverse)" },
  { on = ["s", "s"], run = "sort size --reverse", desc = "Sort by size (largest first)" },
  { on = ["s", "t"], run = "sort mtime --reverse", desc = "Sort by modification time (newest first)" },
  { on = ["w"] , run = "sh -c 'echo \"$YAZI_CWD\" > /tmp/yazi_cwd && exit'", desc = "Set directory and exit"},

  { on = ["z", "A"], run = "show-info atime", desc = "Show access time info" },
  { on = ["z", "c"], run = "show-info ctime", desc = "Show change time info" },
]

prepend_keymap = [
  # ============ SHELL INTERACTIVE COMMANDS ============
  { on = ";", run = "shell --interactive", desc = "Run a shell command" },
  { on = ":", run = "shell --block --interactive", desc = "Run shell command (block until finishes)" },
  { on = "w", run = "quit", desc = "Quit and CD into current directory" },

  { on = ["m", "k"], run = "shell -- qdbus org.kde.kdeconnect /modules/kdeconnect/devices/439fc7a8f3a87d51/sftp mountAndWait", desc = "Mount KDE Connect" },
  { on = ["a", "n"], run = "shell -- sshfs anime@192.168.100.66:/home/anime/Videos/ /home/alpha/mnt/anime/", desc = "Mount anime share via SSHFS" },

  # ============ EDIT / EXTERNAL OPERATIONS ============
  { on = ["e", "e"], run = "open", desc = "Open/edit with default editor" },
  { on = ["e", "i"], run = "shell -- exiftool \"$1\" | less", desc = "Show EXIF metadata" },
  { on = ["e", "g"], run = "shell -- convert \"$1\" \"${1%.*}.pdf\"", desc = "Convert image to PDF" },
  { on = ["e", "p"], run = "shell -- sxiv -t ./* &> /dev/null &", desc = "Preview images in directory" },
  { on = ["e", "P"], run = "shell -- sxiv \"$1\" &> /dev/null &", desc = "Open image with sxiv" },

  # ============ ARCHIVE OPERATIONS ============
  { on = ["a", "z"], run = "shell -- zip -r \"$1\" \"$1\"", desc = "Create ZIP archive" },
  { on = ["a", "t"], run = "shell -- tar cvf \"$1.tar\" \"$1\"", desc = "Create TAR archive" },
  { on = ["a", "g"], run = "shell -- tar cvzf \"$1.tar.gz\" \"$1\"", desc = "Create TAR.GZ archive" },
  { on = ["a", "b"], run = "shell -- tar cjvf \"$1.tar.bz2\" \"$1\"", desc = "Create TAR.BZ2 archive" },
  { on = ["a", "u"], run = "shell -- case \"${1##*.}\" in tar.bz2) tar xjf \"$1\";;tar.gz|tgz) tar xzf \"$1\";;bz2) bunzip2 \"$1\";;rar) unrar x \"$1\";;gz) gunzip \"$1\";;tar) tar xf \"$1\";;zip) unzip \"$1\";;Z) uncompress \"$1\";;7z) 7z x \"$1\";;deb) ar x \"$1\";;tar.xz) tar xf \"$1\";;tar.zst) unzstd \"$1\";;esac", desc = "Extract archive" },

  # ============ TRASH MANAGEMENT ============
  { on = ["t", "r"], run = "shell -- trash-restore", desc = "Restore file from trash" },
  { on = ["t", "c"], run = "shell -- trash-empty", desc = "Clear entire trash" },
  { on = ["t", "g"], run = "cd ~/.local/share/Trash/", desc = "Go to trash directory" },
]
